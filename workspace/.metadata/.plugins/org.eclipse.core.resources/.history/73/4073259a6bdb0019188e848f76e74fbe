scchart pacemaker {
  input signal ASense, VSense, AEIEnd, AVIEnd;
  output signal APace, VPace;
  output bool AEIStart, AVIStart, PVARPStart, VRPStart;

  initial state main { 
  	/* AVI – Atrioventricular Interval
	The maximum time between an atrial event and its subsequent ventricular event */
    region AVI:
	
	initial state idle
		--> V_wait with ASense / AVIStart = true
		--> V_wait with APace / AVIStart = true; 
	connector state V_wait
		--> AVI_on immediate with AVIEnd / AVIStart = false
		--> idle immediate with (VSense || VPace) / AVIStart = false;
	state AVI_on
		--> idle with / VSense; AVIStart = false // Added
		--> idle with / VPace; AVIStart = false;
	
	/* PVARP – Post-Ventricular Atrial Refractory Period
	The time after a ventricular event where any atrial events are ignored as Atrial
	Refractory (AR) signals */
    region PVARP:

   initial state idle
    	--> V_wait with ASense / PVARPStart = true
		--> V_wait with APace / PVARPStart = true; 
	connector state V_wait;

	/* VRP – Ventricular Refractory Period
	The time after a ventricular event where any other ventricular events are ignored as
	Ventricular Refractory (VR) signals */
    region VRP:

    initial state idle
    	--> V_wait with ASense / VRPStart = true
		--> V_wait with APace / VRPStart = true; 
	connector state V_wait;
    
	/* AEI – Atrial Escape Interval
	The maximum time between a ventricular event and its subsequent atrial event */
    region AEI:

    initial state idle
		--> A_wait with VSense / AEIStart = true
		--> A_wait with VPace / AEIStart = true;
	connector state A_wait
		--> AEI_on immediate with AEIEnd / AEIStart = false
		--> idle immediate with (ASense || APace) / AEIStart = false;
	state AEI_on
		--> idle with / APace; AEIStart = false;

	/* LRI_timer 
	A timer for the LRI */
	region LRI_timer:
	
	initial state idle;

	/* LRI – Lower Rate Interval
	The slowest rate at which the heart is allowed to operate. This is measured as the time
	between ventricular events */
    region LRI:
    
    initial state idle;
    
    /* URI_timer 
	A timer for the URI */
	region URI_timer:
	
	initial state idle;
    
	/* URI – Upper Rate Interval
	The fastest rate at which the pacemaker will ever pace the heart at. This is measured
	as the time between ventricular events */
    region URI:

    initial state idle;
  };
}